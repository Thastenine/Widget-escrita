<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Widget de Escrita Avançado</title>
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      padding: 30px;
    }
    .container {
      max-width: 650px;
      margin: 0 auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .project label,
    .sessionName label {
      font-size: 16px;
      display: block;
      margin-top: 10px;
    }
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .widgets {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .widget {
      flex: 1;
      background: #fafafa;
      padding: 16px;
      border-radius: 6px;
      border: 1px solid #eee;
      min-width: 280px;
      box-sizing: border-box;
    }
    .widget h2 {
      margin-top: 0;
    }
    #timerDisplay {
      font-size: 36px;
      text-align: center;
      margin: 16px 0;
    }
    .btns button {
      margin: 0 4px 8px 4px;
      padding: 6px 12px;
      border-radius: 5px;
      border: none;
      background: #2f80ed;
      color: white;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
    }
    .btns button:hover {
      background: #1c60c8;
    }
    #toggleHistoryBtn {
      margin-top: 10px;
      background: #4caf50;
    }
    #toggleHistoryBtn:hover {
      background: #3a8e3a;
    }
    ul {
      list-style: none;
      padding-left: 0;
      max-height: 220px;
      overflow-y: auto;
      margin-top: 10px;
      border-top: 1px solid #ccc;
    }
    ul li {
      padding: 6px 8px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
      line-height: 1.3em;
    }
    .no-history {
      font-style: italic;
      color: #888;
      padding: 8px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Time & Words Tracker</h1>
    <div class="project">
      <label for="projectName">Projeto / Livro:</label>
      <input type="text" id="projectName" placeholder="Ex: Livro A" />
    </div>
    <div class="widgets">
      <div class="widget timer">
        <h2>Cronômetro</h2>
        <div id="timerDisplay">00:00</div>
        <div class="btns">
          <button id="startBtn">Começar</button>
          <button id="stopBtn">Parar</button>
          <button id="resetBtn">Resetar</button>
        </div>
        <div class="sessionName">
          <label for="sessionNameTimer">Nome da sessão (tempo):</label>
          <input type="text" id="sessionNameTimer" placeholder="Ex: Prólogo 1" />
        </div>
      </div>
      <div class="widget words">
        <h2>Contador de Palavras</h2>
        <label for="wordCount">Total de palavras escritas:</label>
        <input type="number" id="wordCount" placeholder="Ex: 1200" min="0" />
        <div class="sessionName">
          <label for="sessionNameWords">Nome da sessão (palavras):</label>
          <input type="text" id="sessionNameWords" placeholder="Ex: Prólogo 1" />
        </div>
        <button id="addWordsBtn">Adicionar sessão</button>
      </div>
    </div>

    <button id="toggleHistoryBtn">Mostrar histórico do projeto</button>
    <ul id="historyList" style="display:none;"></ul>
  </div>

  <script>
    // Elementos
    const projectInput = document.getElementById('projectName');

    // Timer
    const timerDisplay = document.getElementById('timerDisplay');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resetBtn = document.getElementById('resetBtn');
    const sessionNameTimerInput = document.getElementById('sessionNameTimer');

    // Words
    const wordCountInput = document.getElementById('wordCount');
    const sessionNameWordsInput = document.getElementById('sessionNameWords');
    const addWordsBtn = document.getElementById('addWordsBtn');

    // History
    const toggleHistoryBtn = document.getElementById('toggleHistoryBtn');
    const historyList = document.getElementById('historyList');

    // Variáveis timer
    let seconds = 0;
    let interval = null;

    // Atualiza o display do timer
    function updateTimer() {
      const m = String(Math.floor(seconds / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      timerDisplay.textContent = `${m}:${s}`;
    }

    // Funções timer
    function startTimer() {
      if (interval) return;
      interval = setInterval(() => {
        seconds++;
        updateTimer();
      }, 1000);
    }

    function stopTimer() {
      if (!interval) return;
      clearInterval(interval);
      interval = null;
      saveTimerSession();
    }

    function resetTimer() {
      stopTimer();
      seconds = 0;
      updateTimer();
    }

    // Salvar sessão de tempo
    function saveTimerSession() {
      const proj = projectInput.value.trim();
      const sessName = sessionNameTimerInput.value.trim();
      if (!proj) {
        alert('Por favor, informe o nome do projeto/livro antes de salvar a sessão de tempo.');
        return;
      }
      if (!sessName) {
        alert('Por favor, informe o nome da sessão de tempo.');
        return;
      }
      const minutos = (seconds / 60).toFixed(2);
      const dataHora = new Date().toLocaleString();
      const sess = {
        projeto: proj,
        tipo: 'tempo',
        nomeSessao: sessName,
        valor: minutos,
        data: dataHora
      };
      saveSession(sess);
      resetTimer();
      sessionNameTimerInput.value = '';
      if (historyList.style.display === 'block') renderHistory();
    }

    // Salvar sessão de palavras
    function saveWordSession() {
      const proj = projectInput.value.trim();
      const sessName = sessionNameWordsInput.value.trim();
      const palavras = parseInt(wordCountInput.value);
      if (!proj) {
        alert('Por favor, informe o nome do projeto/livro antes de salvar a sessão de palavras.');
        return;
      }
      if (!sessName) {
        alert('Por favor, informe o nome da sessão de palavras.');
        return;
      }
      if (isNaN(palavras) || palavras < 0) {
        alert('Por favor, informe um número válido de palavras.');
        return;
      }
      const dataHora = new Date().toLocaleString();
      const sess = {
        projeto: proj,
        tipo: 'palavras',
        nomeSessao: sessName,
        valor: palavras,
        data: dataHora
      };
      saveSession(sess);
      wordCountInput.value = '';
      sessionNameWordsInput.value = '';
      if (historyList.style.display === 'block') renderHistory();
    }

    // Salvar no localStorage
    function saveSession(session) {
      let todasSessoes = JSON.parse(localStorage.getItem('sessoes') || '[]');
      todasSessoes.push(session);
      localStorage.setItem('sessoes', JSON.stringify(todasSessoes));
    }

    // Filtrar e mostrar histórico do projeto atual
    function renderHistory() {
      const proj = projectInput.value.trim();
      if (!proj) {
        historyList.innerHTML = '<li class="no-history">Informe o nome do projeto para ver o histórico.</li>';
        return;
      }
      let todasSessoes = JSON.parse(localStorage.getItem('sessoes') || '[]');
      let sessoesDoProjeto = todasSessoes.filter(s => s.projeto === proj);
      if (sessoesDoProjeto.length === 0) {
        historyList.innerHTML = '<li class="no-history">Nenhuma sessão salva para este projeto.</li>';
        return;
      }
      historyList.innerHTML = '';
      // Mostrar sessões mais recentes primeiro
      sessoesDoProjeto.reverse().forEach(sess => {
        let itemText = `[${sess.data}] ${sess.nomeSessao} — `;
        if (sess.tipo === 'tempo') {
          itemText += `Tempo: ${sess.valor} minutos`;
        } else {
          itemText += `Palavras: ${sess.valor}`;
        }
        const li = document.createElement('li');
        li.textContent = itemText;
        historyList.appendChild(li);
      });
    }

    // Toggle histórico
    toggleHistoryBtn.addEventListener('click', () => {
      if (historyList.style.display === 'none') {
        renderHistory();
        historyList.style.display = 'block';
        toggleHistoryBtn.textContent = 'Esconder histórico do projeto';
      } else {
        historyList.style.display = 'none';
        toggleHistoryBtn.textContent = 'Mostrar histórico do projeto';
      }
    });

    // Eventos dos botões timer
    startBtn.addEventListener('click', startTimer);
    stopBtn.addEventListener('click', stopTimer);
    resetBtn.addEventListener('click', resetTimer);

    // Evento do botão palavras
    addWordsBtn.addEventListener('click', saveWordSession);

    // Atualiza histórico ao mudar o nome do projeto
    projectInput.addEventListener('input', () => {
      if (historyList.style.display === 'block') {
        renderHistory();
      }
    });

    // Inicia display timer zerado
    updateTimer();
  </script>
</body>
</html>